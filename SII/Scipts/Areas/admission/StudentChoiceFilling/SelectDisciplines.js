var forminuse = !1; function page_init() { page_click(), fill_form() } function page_click() { $("#btnSave").on("click", function (e) { e.preventDefault(); var i = $(this), r = i.text(); form_save($(this), function () { $("#btnClear").trigger("click"), i.text(r), i.removeAttr("disabled"), i.removeClass("disabled"), fill_form() }) }), $("#btnSaveAndContinue").on("click", function (e) { e.preventDefault(); var i = $(this); i.text(); form_save($(this), function () { i.text("Redirecting..."), window.location.href = $("#hdfBaseUrl").val() + "admission/StudentChoiceFilling/ChoiceFilling" }) }), $(".chkDisciplines").on("click", function () { var e = $(this), i = e.parent().parent().parent().find(".chkChPL"); e.is(":checked") ? (i.removeAttr("disabled"), i.attr("required", !0)) : (i.removeAttr("checked"), i.attr("disabled", !0), i.removeAttr("required")) }), $("#btnReset").on("click", function (e) { e.preventDefault(), ConfirmCallBack("All selection will be lost.", function () { $("input[type=checkbox]").removeProp("checked") }) }) } function form_save(e, i) { var r = $("#frm"), t = $('input[name="__RequestVerificationToken"]', r).val(), s = e.text(); if (e.hasClass("disabled")) return !1; var n = !1; if ($(".chkDisciplines").each(function () { $(this).is(":checked") && (n = !0) }), forminuse) return !1; if (!n) return ErrorMessage("Please select discipline(s) first!"), !1; var a = !1; if ($(".chkDisciplines").each(function () { var e = $(this); e.is(":checked") && e.parent().parent().parent().find(".chkChPL").each(function () { $(this).is(":checked") && (a = !0) }) }), !a) return ErrorMessage("Please select discipline(s) and programme level(s) first!"), !1; var c = []; $(".chkDisciplines").each(function () { var e = $(this), i = ""; if (e.is(":checked")) { var r = 0; e.parent().parent().parent().find(".chkChPL").each(function () { var e = $(this); e.is(":checked") && (0 == r ? i += e.val() : i = i + "," + e.val(), r++) }), c.push({ Discipline_ID: e.val(), ProgrammeLevel_ID: i }) } }), e.text("Processing....."), e.attr("disabled", !0), e.addClass("disabled"), forminuse = !0, $.ajax({ method: "POST", url: $("#hdfBaseUrl").val() + "admission/StudentChoiceFilling/SaveSDicipline", data: { __RequestVerificationToken: t, SelectedDisciplines: JSON.stringify(c) } }).done(function (r) { "success" == r.c ? SuccessMessageCallBackWithClose(r.m, i, function () { e.text(s), e.removeAttr("disabled"), e.removeClass("disabled") }) : "alreadyexists" == r.c ? (ErrorMessage(r.m), e.text(s), e.removeAttr("disabled"), e.removeClass("disabled")) : "sessionexpired" == r.c ? (ErrorMessage(r.m), e.text(s), e.removeAttr("disabled"), e.removeClass("disabled")) : "servererror" == r.c ? (ErrorMessage(r.m), e.text(s), e.removeAttr("disabled"), e.removeClass("disabled")) : "ChoiceFillingClosed" == r.c && ErrorMessageCallBack(r.m, function () { window.location.href = $("#hdfBaseUrl").val() + "admission/StudentChoiceFilling/Closed" }), forminuse = !1 }).error(function () { ErrorMessage("Processing error. Kindly refresh page and try again!"), e.text(s), e.removeAttr("disabled"), e.removeClass("disabled"), forminuse = !1 }) } function fill_form() { $.ajax({ method: "POST", url: $("#hdfBaseUrl").val() + "admission/StudentChoiceFilling/SelectSDicipline" }).done(function (e) { $(".chkDisciplines").removeProp("checked"), $(".chkChPL").removeProp("checked"), $(".chkChPL").attr("disabled"), $.each(e.sd, function (e, i) { $("#chk" + i.Discipline_ID).trigger("click"); var r = i.ProgrammeLevel_IDs.split(","); $.each(r, function (e, r) { $("#chk_" + i.Discipline_ID + "_" + r).trigger("click") }) }) }).error(function () { ErrorMessage("Processing error. Kindly refresh page and try again!"), btn.text(oldText), btn.removeAttr("disabled"), btn.removeClass("disabled") }) } $(document).ready(function () { page_init() });