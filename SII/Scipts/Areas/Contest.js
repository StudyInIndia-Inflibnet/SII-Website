var forminuse = !1; function page_click() { $("#btn1").on("click", function () { $("#t1").show(), $("#t2").hide(), $("#t3").hide() }), $(".saveandnext2").on("click", function (e) { e.preventDefault(); var r = $(this), a = $("#frm1"); return a.parsley().validate(), !!a.parsley().isValid() && (!forminuse && (r.text("Processing....."), r.attr("disabled", !0), r.addClass("disabled"), void $.ajax({ method: "POST", url: $("#hdfBaseUrl").val() + "Contest/CheckDtl", data: $("#frm1").serialize() }).done(function (e) { "success" == e.c ? SuccessMessageCallBack(e.m, function () { r.text("Next"), r.removeAttr("disabled"), r.removeClass("disabled"), $("#t1").hide(), $("#t2").show(), $("#t3").hide() }) : "alreadyexists" == e.c ? (ErrorMessage(e.m), r.text("Next"), r.removeAttr("disabled"), r.removeClass("disabled")) : "sessionexpired" == e.c ? (ErrorMessage(e.m), r.text("Next"), r.removeAttr("disabled"), r.removeClass("disabled")) : "servererror" == e.c && (ErrorMessage(e.m), r.text("Next"), r.removeAttr("disabled"), r.removeClass("disabled")), forminuse = !1 }).error(function () { ErrorMessage("Processing error. Kindly refresh page and try again!"), r.text("Next"), r.removeAttr("disabled"), r.removeClass("disabled"), forminuse = !1 }))) }), $(".saveandnext3").on("click", function (e) { e.preventDefault(); var r = $("#frm2"); if (r.parsley().validate(), !r.parsley().isValid()) return !1; $("#t1").hide(), $("#t2").hide(), $("#t3").show() }), $("#tbody").on("click", ".btn-upload-doc", function (e) { e.preventDefault(); var r = $(this), a = r.attr("data-id"), t = $("#txtMobile").val(), s = $("#frm" + a), i = null, l = null, o = null; if (s.parsley().validate(), !s.parsley().isValid()) return !1; var d = r.html(); if (r.hasClass("disabled")) return !1; r.text("Processing....."), r.attr("disabled", !0), r.addClass("disabled"); var n = $("#fuDoc" + a).get(0); if (void 0 !== window.FormData && $("#fuDoc" + a).get(0).files.length > 0) { var c = $("#fuDoc" + a).get(0).files[0].size; if ("frmTestimonialVideo" == s.attr("id") ? (i = ["avi", "mpeg4", "mov", "wmv", "mp4", "3gpp", "zip"], l = 1073741824, o = "1 GB") : (i = ["pdf", "jpeg", "jpg"], l = 26214400, o = "25 MB"), -1 == $.inArray($("#fuDoc" + a).val().split(".").pop().toLowerCase(), i)) return void ErrorMessageCallBack("Only formats are allowed : " + i.join(", "), function () { r.html(d), r.removeAttr("disabled"), r.removeClass("disabled") }); if (!(l >= c)) return void ErrorMessageCallBack("Maximum allowed file size : " + o, function () { r.html(d), r.removeAttr("disabled"), r.removeClass("disabled") }) } for (var m = n.files, f = new FormData, u = 0; u < m.length; u++)f.append(m[u].name, m[u]); f.append("id", a), f.append("Mobile", t), f.append("name", r.parent().parent().parent().find("td:eq(0)").text()), f.append("__RequestVerificationToken", $('input[name="__RequestVerificationToken"]', s).val()), $.ajax({ method: "POST", url: $("#hdfBaseUrl").val() + "Contest/UploadDocs", data: f, async: !1, cache: !1, contentType: !1, processData: !1 }).done(function (e) { "success" == e.c ? SuccessMessageCallBack(e.m, function () { $("#td" + a).html('<a class="label label-success" style="text-align:center" href="' + $("#hdfBaseUrl").val() + e.p + '" target="_blank"><i class="fa fa-download"></i> View</a>'), $("#hdf" + a).val(e.p), r.html(d), r.removeAttr("disabled"), r.removeClass("disabled") }, function () { r.text(d), r.removeAttr("disabled"), r.removeClass("disabled") }) : "alreadyexists" == e.c ? (ErrorMessage(e.m), r.html(d), r.removeAttr("disabled"), r.removeClass("disabled")) : "sessionexpired" == e.c ? (ErrorMessage(e.m), r.html(d), r.removeAttr("disabled"), r.removeClass("disabled")) : "servererror" == e.c ? (ErrorMessage(e.m), r.html(d), r.removeAttr("disabled"), r.removeClass("disabled")) : "fileExtension" == e.c && (ErrorMessage(e.m), r.html(d), r.removeAttr("disabled"), r.removeClass("disabled")) }).error(function () { ErrorMessage("Processing error. Kindly refresh page and try again!"), r.html(d), r.removeAttr("disabled"), r.removeClass("disabled") }) }), $("#btnsubmit").on("click", function (e) { if (e.preventDefault(), 0 == $("#chkfinaldec").prop("checked")) return ErrorMessage("Please accept declaration before proceeding."), !1; var r = $(this); form_save($(this), function () { clear(), r.text("Redirecting..."), window.location.href = $("#hdfBaseUrl").val() + "Contest/Submit" }) }) } function page_validation() { $(".allownumberonly").SetNumericOnly(), $(".allowAlphabetOnly").SetAlphabetOnly(), $(".allowAlphanumericonly").SetAlphaNumericOnly() } function page_change() { $("#drpCourseOfStudy").on("change", function (e) { e.preventDefault(), "0" == $(this).val() ? ($("#divCourseOther").show(), $("#txtCourseOther").attr("required", !0)) : ($("#divCourseOther").hide(), $("#txtCourseOther").removeAttr("required")) }) } function form_save(e, r) { if (forminuse) return !1; var a = e.text(); if (e.hasClass("disabled")) return !1; var t = !0, s = []; if ($("#tbody").find("tr").each(function (e) { var r = $(this), a = r.find(".doc_path").val(), i = r.attr("data-id"), l = r.find("td:eq(0)").text(), o = r.find(".btn-upload-doc").attr("data-for"); "" == a && (t = !1), s.push({ UploadType: i, Upload_Name: l, Path: a, Upload_For: o }) }), !t) return ErrorMessage("Kindly upload all documents."), !1; e.text("Processing....."), e.attr("disabled", !0), e.addClass("disabled"), forminuse = !0, $.ajax({ method: "POST", url: $("#hdfBaseUrl").val() + "Contest/SaveUploadDocs", data: $("#frm1").serialize() + "&" + $("#frm2").serialize() + "&Docs=" + JSON.stringify(s) }).done(function (t) { "success" == t.c ? SuccessMessageCallBack(t.m, r, function () { e.text(a), e.removeAttr("disabled"), e.removeClass("disabled") }) : "alreadyexists" == t.c ? (ErrorMessage(t.m), e.text(a), e.removeAttr("disabled"), e.removeClass("disabled")) : "sessionexpired" == t.c ? (ErrorMessage(t.m), e.text(a), e.removeAttr("disabled"), e.removeClass("disabled")) : "servererror" == t.c ? (ErrorMessage(t.m), e.text(a), e.removeAttr("disabled"), e.removeClass("disabled")) : "ChoiceFillingClosed" == t.c && ErrorMessageCallBack(t.m, function () { window.location.href = $("#hdfBaseUrl").val() + "Contest" }), forminuse = !1 }).error(function () { ErrorMessage("Processing error. Kindly refresh page and try again!"), e.text(a), e.removeAttr("disabled"), e.removeClass("disabled"), forminuse = !1 }) } function clear() { $("#frm1")[0].reset(), $("#frm2")[0].reset(), $("#frmCitizenship")[0].reset(), $("#frmCollegeID")[0].reset(), $("#frmTestimonialVideo")[0].reset() } $(document).ready(function () { history.pushState(null, null, location.href), window.onpopstate = function () { history.go(1) }, clear(), page_click(), page_change(), page_validation() });